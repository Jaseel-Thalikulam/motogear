<%-include('../layouts/header.ejs') %>


  <head>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.css" />
  </head>


  <!-- ======= Header ======= -->
  <header id="header" class="header fixed-top d-flex align-items-center">

    <div class="d-flex align-items-center justify-content-between">
      <a href="index.html" class="logo d-flex align-items-center">

        <span class="d-none d-lg-block">MOTOGEAR</span>
      </a>
      <i class="bi bi-list toggle-sidebar-btn"></i>
    </div><!-- End Logo -->



    <nav class="header-nav ms-auto">
      <ul class="d-flex align-items-center">






        <li class="nav-item dropdown pe-3">

          </a><!-- End Profile Iamge Icon -->
          <a class="nav-link nav-profile d-flex align-items-center pe-0" href="#" data-bs-toggle="dropdown">
            <img src="/assets/img/profile-user.png" alt="Profile" class="rounded-circle">
            <span class="d-none d-md-block dropdown-toggle ps-2">
              <%=user.name%>
            </span>
          </a><!-- End Profile Iamge Icon -->

          <ul class="dropdown-menu dropdown-menu-end dropdown-menu-arrow profile">
            <li class="dropdown-header">
              <h6>
                <%=user.name%>
              </h6>
              <span>Admin</span>
            </li>

            <li>
              <a class="dropdown-item d-flex align-items-center" href="/admin/profile">
                <i class="bi bi-person"></i>
                <span>My Profile</span>
              </a>
            </li>

            <li>
              <a class="dropdown-item d-flex align-items-center" href="/admin/logout">
                <i class="bi bi-box-arrow-right"></i>
                <span>Sign Out</span>
              </a>
            </li>

          </ul><!-- End Profile Dropdown Items -->
        </li><!-- End Profile Nav -->

      </ul>
    </nav><!-- End Icons Navigation -->

  </header><!-- End Header -->

  <!-- ======= Sidebar ======= -->
  <aside id="sidebar" class="sidebar">

    <ul class="sidebar-nav" id="sidebar-nav">

      <li class="nav-item">
        <a class="nav-link collapsed " href="/admin/dashboard">
          <i class="bi bi-grid"></i>
          <span>Dashboard</span>
        </a>
      </li><!-- End Dashboard Nav -->

      <li class="nav-item">
        <a class="nav-link collapsed" href="/admin/category">
          <i class="bi bi-menu-button-wide"></i>
          <span>Category</span>
        </a>
      </li><!-- End Dashboard Nav -->

      <li class="nav-item">
        <a class="nav-link " href="/admin/products">
          <i class="bi bi-menu-button-wide"></i>
          <span>Products</span>
        </a>
      </li><!-- End Dashboard Nav -->

      <li class="nav-item">
        <a class="nav-link collapsed" href="/admin/userslist">
          <i class="ri-account-circle-line"></i>
          <span>Users</span>
        </a>
      </li><!-- End Dashboard Nav -->
      <li class="nav-item">
        <a class="nav-link collapsed" href="/admin/orders">
          <i class="bi bi-menu-button-wide"></i>
          <span>Orders</span>
        </a>
      </li><!-- End Dashboard Nav -->
      <li class="nav-item">
        <a class="nav-link collapsed" href="/admin/coupon">
          <i class="bi bi-journal-text"></i><span>Coupon</span>
        </a>

      </li><!-- End Icons Nav -->
      <li class="nav-item">
        <a class="nav-link collapsed" href="/admin/banner">
          <i class="bi bi-journal-text"></i><span>Banner</span>
        </a>

      </li><!-- End Icons Nav -->
      <li class="nav-item">
        <a class="nav-link collapsed" href="/admin/sales">
          <i class="bi bi-journal-text"></i><span>Sales</span>
        </a>

      </li><!-- End Icons Nav -->
    </ul>

  </aside><!-- End Sidebar-->

  <main id="main" class="main">

    <div class="pagetitle">
      <h1>Add-Product</h1>
      <nav>
        <ol class="breadcrumb">
          <li class="breadcrumb-item"><a href="/admin">Home</a></li>
          <li class="breadcrumb-item"><a href="/admin/products">Product</a></li>
          <li class="breadcrumb-item active">Add-Product</li>
        </ol>
      </nav>
    </div><!-- End Page Title -->

    <div class="card">
      <div class="card-body">
        <h5 class="card-title">Enter Product Details</h5>

        <!-- Floating Labels Form -->
        <form class="row g-3" method="post" enctype="multipart/form-data">
          <div class="col-md-12">
            <div class="form-floating">
              <input type="text" maxlength="42" name="productname" class="form-control" id="floatingName"
                placeholder="Product Name">
              <label for="floatingName">Product Name</label>
            </div>
          </div>

          <div class="col-md-4">
            <div class="form-floating mb-3">
              <select class="form-select" id="floatingSelect" aria-label="State" name="category">
                <option selected hidden>Select Category </option>

                <% category.forEach(function(category) { %>

                  <% if(category.categoryStatus==true){ %>
                    <option>
                      <%= category.category %>
                    </option>
                    <% }%>
                      <% }); %>
              </select>


              <label for="floatingSelect">Category</label>
            </div>
          </div>



          <div class="row mb-3">
            <label for="inputNumber" class="col-sm-2 col-form-label">Upload Product Images</label>
            <div class="col-sm-10">
              <input multiple type="file" id="formFile" name="image" onchange="previewImages(event)">
              <div class="mt-2">
                <div id="preview-container"></div>
              </div>
            </div>
          </div>

          <div class="row mb-3">
            <label for="inputNumber" class="col-sm-2 col-form-label">Crop Image</label>
            <div class="col-sm-10">
              <input class="image" type="file" id="formFile">
              <div class="mt-2">
                <div id="preview-container"></div>
              </div>
            </div>
          </div>

          <div class="col-12">
            <div class="form-floating">
              <textarea class="form-control" placeholder="Address" name="description" id="floatingTextarea"
                style="height: 100px;"></textarea>
              <label for="floatingTextarea">Description</label>
            </div>
          </div>

          <div class="col-md-6">
            <div class="form-floating">
              <input type="number" name="stock" class="form-control" id="floatingEmail" placeholder="Product Stock">
              <label for="floatingEmail">Product Stock</label>
            </div>
          </div>

          <div class="col-md-6">
            <div class="form-floating">
              <input type="number" name="price" class="form-control" id="floatingEmail" placeholder="Product Price">
              <label for="floatingEmail">Product Price</label>
            </div>
          </div>

          <div class="col-md-6">
            <div class="form-floating">
              <input type="number" name="offer" class="form-control" id="floatingEmail" placeholder="Product Price">
              <label for="floatingEmail">Offer</label>
            </div>
          </div>

          <div class="text-center">
            <button type="submit" class="btn btn-primary">Submit</button>
            <button type="reset" class="btn btn-secondary">Reset</button>

            <p style="color: green;"></p>
          </div>

          <% if(typeof message!=='undefined' ){ %>
            <p style="color: #08aa08;">
              <%= message %>
            </p>
            <% } %>
        </form><!-- End floating Labels Form -->


      </div>
    </div>

    <div class="modal fade" id="modal" tabindex="-1" role="dialog" aria-labelledby="modalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="modalLabel">Crop image</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">Ã—</span>
            </button>
          </div>
          <div class="modal-body">
            <div class="img-container">
              <div class="row">
                <div class="col-md-8">
                  <!--  default image where we will set the src via jquery-->
                  <img id="image">
                </div>
                <div class="col-md-4">
                  <div class="preview"></div>
                </div>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
            <button type="button" class="btn btn-primary" id="crop">Crop</button>
          </div>
        </div>
      </div>
    </div>

    </div>
    </div>
    <style>
      .preview {
        overflow: hidden;
        width: 160px;
        height: 160px;
        margin: 10px;
        border: 1px solid red;
      }

      #image {
        display: block;
        max-width: 100%;
      }
    </style>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.js"></script>
    <script>

      var bs_modal = $('#modal');
      var image = document.getElementById('image');
      var cropper, reader, file;


      $("body").on("change", ".image", function (e) {
        var files = e.target.files;
        var done = function (url) {
          image.src = url;
          bs_modal.modal('show');
        };


        if (files && files.length > 0) {
          file = files[0];

          if (URL) {
            done(URL.createObjectURL(file));
          } else if (FileReader) {
            reader = new FileReader();
            reader.onload = function (e) {
              done(reader.result);
            };
            reader.readAsDataURL(file);
          }
        }
      });

      bs_modal.on('shown.bs.modal', function () {
        cropper = new Cropper(image, {
          aspectRatio: 1,
          viewMode: 3,
          preview: '.preview'
        });
      }).on('hidden.bs.modal', function () {
        cropper.destroy();
        cropper = null;
      });

      $("#crop").click(function () {
        console.log("crop")
        canvas = cropper.getCroppedCanvas({
          width: 160,
          height: 160,
        });

        canvas.toBlob(function (blob) {
          url = URL.createObjectURL(blob);
          var reader = new FileReader();
          reader.readAsDataURL(blob);
          reader.onloadend = function () {
            var base64data = reader.result;
            // alert(base64data);
            $.ajax({
              type: "POST",
              dataType: "json",
              url: "/admin/uploadcrp",
              data: { image: base64data },
              success: function (data) {
                bs_modal.modal('hide');
                alert("success upload image");
              },
              error: function (xhr, status, error) {
                console.error(error);
                alert("Failed to upload image.");
              }
            });


          };
        });
      });

    </script>


    <script>
      function previewImages(event) {
        var files = event.target.files;
        var previewContainer = document.getElementById('preview-container');
        previewContainer.innerHTML = '';
        for (var i = 0; i < files.length; i++) {
          var file = files[i];
          var reader = new FileReader();
          reader.onload = function () {
            var image = new Image();
            image.src = this.result;
            image.style.width = '200px'; // set the width to 200 pixels
            image.style.height = '200px';
            image.style.margin = "2px" // set the height to 200 pixels
            previewContainer.appendChild(image);
          }
          reader.readAsDataURL(file);
        }
      }

    </script>



    <%-include('../layouts/footer.ejs') %>