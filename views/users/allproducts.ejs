<%-include('../layouts/userheader.ejs') %>

<div id="wrapper">

    <header class="header_area bg-img background-overlay-dark" style="background-image: url(/assets/img/pexels-pragyan-bezbaruah-1715193.jpg);">
        <!-- Top Header Area Start -->
        <div class="top_header_area" style="background-color: rgba(0,0,0,0.5);">
            <div class="container h-200">
                <div class="row h-100 align-items-center justify-content-end">

                    <div class="col-12 col-lg-7">
                      <div class="top_single_area d-flex align-items-center">
                          <div class="top_logo">
                              <a href="#"><img src="/assets/img/White logo - no background.svg" style="width: 150px; height: 100px;" alt=""></a>
                          </div>
                
                            <div class="header-cart-menu d-flex align-items-center ml-auto">
                                <!-- Cart Area -->
                                <%if(user){%>
                                    <div class="cart">
                                        <a href="/cart" id="header-cart-btn" target="_blank"><span class="cart_quantity"><%=countcart%></span><i class="ti-bag" style="color:#fff"></i></a>
                                        <!-- Cart List Area Start -->
                                        
                                    </div>
                                  <%}%>
                                <!-- <div class="header-right-side-menu ml-15">
                                    <a href="#" id="sideMenuBtn"><i class="ti-menu" aria-hidden="true"></i></a>
                                </div> -->
                            </div>
                        </div>
                    </div>

                </div>

                <div class="row h-100 align-items-center justify-content-center ">

                  <div class="col-12 col-lg-7 ">
                    <div class="content">
                      <div class="search">
                        <input style="background-color: transparent; color: #ccc;" id="search-input" type="text" class="search__input" aria-label="search" placeholder="Find the perfect gear for your ride..." autocomplete="off">
                      </div>
                    </div>
                  </div>
                  
                  
                  
       
                  </div>

            </div>
        </div>

        <!-- Top Header Area End -->
        <div class="main_header_area"  style="background-color: rgba(0,0,0,0.5);">
            <div class="container h-100" >
                <div class="row h-100">

                   

                    <div class="col-12 d-md-flex justify-content-center"  >
                        <!-- Header Social Area -->
                       
                        <!-- Menu Area -->
                      
                                                   
                            <div class="main-menu-area">
                            <nav class="navbar navbar-expand-lg align-items-start">

                                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#karl-navbar" aria-controls="karl-navbar" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"><i class="ti-menu"></i></span></button>

                                <div class="collapse navbar-collapse align-items-start collapse" id="karl-navbar" style="background-color: transparent;">
                                    <ul class="navbar-nav animated" id="nav" >
                                        <li class="nav-item active"><a class="nav-link" href="/"  style="color: #fff;">Home</a></li>
                                      
                                        <li class="nav-item"><a class="nav-link" href="/allproducts"  style="color: #fff;">EXPLORE OUR PRODUCTS</a></li>
                                        <!-- <li class="nav-item"><a class="nav-link" href="#"> RIDING GLOVES</a></li>
                                        <li class="nav-item"><a class="nav-link" href="#"><span class="karl-level">hot</span> RIDING JACKETS</a></li> -->

                                        <% if (user){%>

                                            <li class="nav-item dropdown">
                                              <a class="nav-link dropdown-toggle" href="#" id="karlDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" style="text-transform: capitalize; color: #fff;" aria-expanded="false">Hello, <%=user.name%></a>

                                                <div class="dropdown-menu"  aria-labelledby="karlDropdown">
                                                    
                                                    
                                                     
                                                    <a class="dropdown-item" href="/profile/<%=user._id%>"  ">My Profile</a>
                                                     <a class="dropdown-item" href="/logout"  >Logout</a>
                                           
                                                   
                                                </div>
                                            </li>
                                           

                                        <%}else{%>

                                            <li class="nav-item"><a class="nav-link" href="/login"  style="color: #fff;">Login</a></li>
                                            
                                        <%}%>
                                       
                                    </ul>
                                </div>
                            </nav>
                        </div>
                        <!-- Help Line -->
                 

                       
                    </div>
                </div>
            </div>
        </div>
        </header>
<!-- ****** Header Area End ****** -->

<div id="search-title" style="text-align: center ; "  ></div>

<div class="container">
  
  <div class="select-container">
    <select id="sort-select" class="form-select" aria-label="sort by">
      <option value="" hidden selected>Sort by</option>
      <option value="asc">Price: Low to High</option>
      <option value="desc">Price: High to Low</option>
    </select>
  
    <select id="filter-select" class="form-select" aria-label="filter by" >
      <option value="" hidden selected>Filter by</option>
      <% if (categories.length > 0) { %>
      <% for (let i = 0; i < categories.length; i++) { %> 
      <% if (categories[i].categoryStatus == true) { %>
      <option value="<%= categories[i].category %>"><%= categories[i].category %></option>
      <% } %>
      <% } %>
      <% } %>
    </select>
  </div>
<div id="search-results" class="row"  ></div>
<div id="search-results-404"  style="text-align: center;"  ></div>


</div>
    <!-- ****** New Arrivals Area Start ****** -->
    <section class="new_arrivals_area section_padding_100_0 clearfix">
        <div class="container">
            <div class="row">
                <div class="col-12">
                    <div class="section_heading text-center">
                        <h2>All Products at a Glance</h2>
                    </div>
                </div>
            </div>
        </div>

        <div class="karl-projects-menu mb-100">
            <div class="text-center portfolio-menu">

                 <button class="btn active" data-filter="*">ALL</button>
                <%
                if(categories.length > 0){
                for(let i=0;i<categories.length;i++){
                    %>
               
                <button class="btn" data-filter=".<%= categories[i].category %>"><%= categories[i].category %></button>
                <!-- <button class="btn" data-filter=".jackets">JACKETS</button>
                <button class="btn" data-filter=".access">GLOVES</button> -->
             

                <%
            }
            }else{
            %>
            <tr>
                <td colspan="3">Categories Not Found</td>
            </tr>
            
            <%
            }
            
            %>
  
            </div>
        </div>

        <div class="container">
            <div class="row karl-new-arrivals">

              
                
                <!-- Single gallery Item Start -->
                <% for(i=product.length-1;i>=0;i--){ %>

                    <%if(product[i].show==true){%>


                        <%if(product[i].offer>0){%>
                    <div class="col-12 col-sm-6 col-md-4 single_gallery_item <%=product[i].Category%> wow fadeInUpBig" data-wow-delay="0.2s">
                        <!-- Product Image -->
                        <div class="product-img">
                            <img style="border-radius: 5px;" src="/assets/img/<%= product[i].image[0]%>" alt="">
                            <div class="product-quicview">
                                <a href="/productdetails/<%= product[i]._id%>"></a>
                            
                            </div>
                        </div>
                        <!-- Product Description -->
                        <div class="product-description">
                            <h4 class="product-price">
                                ₹<%= product[i].offerprice.toLocaleString('en-IN') %>
                                <span style="text-decoration: line-through;">
                                  ₹<%= product[i].price.toLocaleString('en-IN') %>
                                </span>
                              </h4>
                          
                            <p><%=product[i].product %></p>
                           
                            <!-- Add to Cart -->
                            <a href="#"  onclick="addToWishlist('<%= product[i]._id %>')"  class="add-to-cart-btn">ADD TO WISHLIST</a>

                        </div>
                    </div>
                    <%}else{%>
    
                        <div class="col-12 col-sm-6 col-md-4 single_gallery_item <%=product[i].Category%> wow fadeInUpBig" data-wow-delay="0.2s">
                            <!-- Product Image -->
                            <div class="product-img">
                                <img style="border-radius: 5px;" src="/assets/img/<%= product[i].image[0]%>" alt="">
                                <div class="product-quicview">
                                    <a href="/productdetails/<%= product[i]._id%>"></a>
                                
                                </div>
                            </div>
                            <!-- Product Description -->
                            <div class="product-description">
                                <h4 class="product-price">₹<%= product[i].price.toLocaleString('en-IN') %></h4>
                              
                                <p><%=product[i].product %></p>
                               
                                <!-- Add to Cart -->
                                <a href="#"  onclick="addToWishlist('<%= product[i]._id %>')"  class="add-to-cart-btn">ADD TO WISHLIST</a>
    
                            </div>
                        </div>

                        <%}%>

                    <%}%>

                    <% }; %> 
               



               

            </div>

            <div class="store-filter clearfix">
                <% if(typeof countproducts!=='undefined'){%>
                <ul class="store-pagination">
                  
                  <% for(let i=1;i<=countproducts;i++){ %>
                  <li><a class="<%= i===currentPage ? 'active' : '' %>" href="?page=<%=i %>"><%=i %></a></li>
                  <% } %>
                 
                <%}%>
              </div>
              

           

        </div>
        
                
                
    </section>
    <!-- ****** New Arrivals Area End ****** -->
  
     <!--****** Quick View ****** -->


    <!-- 
  ****** Footer Area Start ****** -->
    <footer class="footer_area">
        <div class="container">
            <div class="row">
                <!-- Single Footer Area Start -->
                <div class="col-12 col-md-6 col-lg-3">
                    <div class="single_footer_area">
                        <div class="footer-logo">
                            <img src="/public/userassets/img/core-img/logo.png" alt="">
                        </div>
                        <div class="copywrite_text d-flex align-items-center">
                            <p><!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->

<!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. --></p>
                        </div>
                    </div>
                </div>
                <!-- Single Footer Area Start -->
                <div class="col-12 col-sm-6 col-md-3 col-lg-2">
                    <div class="single_footer_area">
                        <ul class="footer_widget_menu">
                            <li><a href="#">About</a></li>
                            <li><a href="#">Blog</a></li>
                            <li><a href="#">Faq</a></li>
                            <li><a href="#">Returns</a></li>
                            <li><a href="#">Contact</a></li>
                        </ul>
                    </div>
                </div>
                <!-- Single Footer Area Start -->
                <div class="col-12 col-sm-6 col-md-3 col-lg-2">
                    <div class="single_footer_area">
                        <ul class="footer_widget_menu">
                            <li><a href="#">My Account</a></li>
                            <li><a href="#">Shipping</a></li>
                            <li><a href="#">Our Policies</a></li>
                            <li><a href="#">Afiliates</a></li>
                        </ul>
                    </div>
                </div>
                <!-- Single Footer Area Start -->
                <div class="col-12 col-lg-5">
                    <div class="single_footer_area">
                        
                    </div>
                </div>
            </div>
            <div class="line"></div>

            <!-- Footer Bottom Area Start -->
            <div class="footer_bottom_area">
                <div class="row">
                    <div class="col-12">
                        <div class="footer_social_area text-center">
                            <a href="#"><i class="fa fa-pinterest" aria-hidden="true"></i></a>
                            <a href="#"><i class="fa fa-facebook" aria-hidden="true"></i></a>
                            <a href="#"><i class="fa fa-twitter" aria-hidden="true"></i></a>
                            <a href="#"><i class="fa fa-linkedin" aria-hidden="true"></i></a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </footer>
    <!-- ****** Footer Area End ****** -->
</div>
<!-- /.wrapper end -->

<style>

.select-container {
  display: none;
  padding-bottom: 10px;
  padding-top: 10px;
  
}
.store-pagination li a.active {
  background-color: #FF084E;
  color: #fff;
}


    .store-filter {
  display: flex;
  justify-content: center;
  /* margin-top: 20px; */
  margin-bottom: 20px;
}

.store-pagination {
  display: flex;
  list-style: none;
  margin: 0;
  padding: 0;
}

.store-pagination li {
  margin: 0 5px;
}

.store-pagination li a {
  display: block;
  padding: 5px 10px;
  border-radius: 3px;
  background-color: #f5f5f5;
  color: #333;
  text-decoration: none;
}

.store-pagination li a:hover {
  background-color: #FF084E;
  color: #fff;
}


/* Styles for the search input */
.search__input {
  background-color: transparent;
  color: #ccc;

  padding: 5px;
  font-size: 16px;
  width: 80%;
}

/* Styles for the search input */
.search__input {
  background-color: transparent;
  color: #ccc;
  padding: 5px;
  font-size: 16px;
  width: 80%;
  outline: none; /* Remove the default outline */
border-radius: 20px;

}
.search__input::placeholder {
  color: #ccc; /* Placeholder color */
  font-size: 14px; /* Adjust the size of the placeholder text */
  padding-left: 2px;
}

</style>

<script>



$('#search-input, #sort-select, #filter-select').on('change input', function() {
  var query = $('#search-input').val();
  var sortField = $('#sort-select').val();
  var filterField = $('#filter-select').val();

  

  if (query.trim() !== '') {
    // Send AJAX request to server to search, sort, and filter items
    $.ajax({
      timeout: 5000,
      url: '/searchSortFilter',
      type: 'GET',
      data: { q: query, sortField: sortField, filterField: filterField },
      dataType: 'json',
      success: function(results) {
        // Update the search results on the pages
    
        if(results.length>0){

        
        $('#search-results').html('');
        $('#search-title').html('');
        $('#search-title').html('<h2 style="font-size:48px">SEARCH RESULTS</h2>');
        results.forEach(function(result) {
          var imageUrl = '/assets/img/' + result.image[0];
          var imageTag = '<img style="height: 350px; width: 350px;" src="' + imageUrl + '">';
          var productUrl = '/productdetails/'+result._id;
          var productName = '<p>'+result.product+'</p>';
          var productPrice = '<h4 style="color:#9f9f9f ;font-weight: 450" class="product-price">'+'₹'+result.price+'</h4>';
          $('#search-results').append('<div class="col-12 col-sm-6 col-md-4" >' + '<a href="' + productUrl+ '">' + '<div>' + imageTag +  productPrice + productName + '</div>' + '</a>' + '</div>');
          $('.select-container').show();  
        });
        $('#search-results-404').html('');

      }else{
        $('#search-results').html('');
     
        $('#search-title').html('<h2 style="font-size:48px">SEARCH RESULTS</h2>');
     
        
        $('#search-results-404').html('<h1>Oh no! Your search came up empty.</h1><p>We couldn\'t find any results matching your search terms. Feel free to explore our other categories or get in touch with us for personalized recommendations.</p>');
        

      }
      },
      error: function(xhr, status, error) {
        console.log(error);
      }
    });
  } else {
    // Clear search results and title

    $('#search-results').html('');
    $('#search-results-404').html('');
    $('#search-title').html('');
    $('.select-container').hide();
  }
});




function addToWishlist(proId) {
   
    console.log(proId)
 $.ajax({
    url: '/addToWishlist',
    data: {
      productId: proId
    },
    method: "post",
    success: (response) => {
      if (response.success) {
        $('.table-shopping-cart').load('/wishlist .table-shopping-cart')
        console.log(response);
        Swal.fire({
          title: 'Added',
          text: 'Item added to wishlist',
          icon: 'success',
          timer: 1000,
          showConfirmButton: false
        })
      } else {
        Swal.fire({
          text: 'Item already in wishlist',
          icon: 'info',
          timer: 1000,
          showConfirmButton: false
        })
      }
      console.log(response);
    }
  })
 }
   </script>

<%-include('../layouts/userfooter.ejs') %>