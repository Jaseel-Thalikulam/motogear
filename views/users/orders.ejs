
<%-include('../layouts/userheader.ejs') %>



<div id="wrapper">

    <!-- ****** Header Area Start ****** -->
    <header class="header_area bg-img background-overlay-white" style="background-image: url(/assets/img/pexels-pragyan-bezbaruah-1715193.jpg);">
        <!-- Top Header Area Start -->
        <div class="top_header_area">
            <div class="container h-100">
                <div class="row h-100 align-items-center justify-content-end">

                    <div class="col-12 col-lg-7">
                        <div class="top_logo">
                            <a href="#"><img src="/userassets/img/core-img/logo.png" style="width: 70px;" alt=""></a>
                        </div>
                        <div class="top_single_area d-flex align-items-center">
                            <!-- Logo Area -->
                           
                            <!-- Cart & Menu Area -->

                      

                            <div class="header-cart-menu d-flex align-items-center ml-auto">
                                <!-- Cart Area -->
                                <%if(user){%>
                                    <div class="cart">
                                        <a href="/cart" id="header-cart-btn" target="_blank"><span class="cart_quantity"><%=countcart%></span><i class="ti-bag"></i> Your Cart</a>
                                        <!-- Cart List Area Start -->
                                        
                                    </div>
                                  <%}%>
                                <!-- <div class="header-right-side-menu ml-15">
                                    <a href="#" id="sideMenuBtn"><i class="ti-menu" aria-hidden="true"></i></a>
                                </div> -->
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>

        <!-- Top Header Area End -->
        <div class="main_header_area">
            <div class="container h-100">
                <div class="row h-100">

                   

                    <div class="col-12 d-md-flex justify-content-center"  >
                        <!-- Header Social Area -->
                       
                        <!-- Menu Area -->
                      
                                                   
                            <div class="main-menu-area">
                            <nav class="navbar navbar-expand-lg align-items-start">

                                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#karl-navbar" aria-controls="karl-navbar" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"><i class="ti-menu"></i></span></button>

                                <div class="collapse navbar-collapse align-items-start collapse" id="karl-navbar">
                                    <ul class="navbar-nav animated" id="nav">
                                        <li class="nav-item active"><a class="nav-link" href="/">Home</a></li>
                                      
                                        <li class="nav-item"><a class="nav-link" href="/allproducts">EXPLORE OUR PRODUCTS</a></li>
                                        <!-- <li class="nav-item"><a class="nav-link" href="#"> RIDING GLOVES</a></li>
                                        <li class="nav-item"><a class="nav-link" href="#"><span class="karl-level">hot</span> RIDING JACKETS</a></li> -->

                                        <% if (user){%>

                                            <li class="nav-item dropdown">
                                                <a class="nav-link dropdown-toggle" href="#" id="karlDropdown" role="button" data-toggle="dropdown"  aria-haspopup="true" style="text-transform: capitalize;" aria-expanded="false">Hello,<%=user.name%></a>
                                                <div class="dropdown-menu"  aria-labelledby="karlDropdown">
                                                    
                                                    
                                                     
                                                    <a class="dropdown-item" href="/profile/<%=user._id%>">My Profile</a>
                                                     <a class="dropdown-item" href="/logout">Logout</a>
                                           
                                                   
                                                </div>
                                            </li>
                                           

                                        <%}else{%>

                                            <li class="nav-item"><a class="nav-link" href="/login">Login</a></li>
                                            
                                        <%}%>
                                       
                                    </ul>
                                </div>
                            </nav>
                        </div>
                        <!-- Help Line -->
                 

                       
                    </div>
                </div>
            </div>
        </div>
        </header>
<!-- ****** Header Area End ****** -->
    <!-- ****** Header Area End ****** -->

    <!-- ****** Top Discount Area Start ****** -->
   
    <!-- ****** Top Discount Area End ****** -->

    <!-- ****** Cart Area Start ****** -->
    <div class="cart_area section_padding_100 clearfix">
        <div class="container">
            <div class="row">
                <div class="col-12">

                    
                                <div class="section_heading text-center">
                                    <h2>My orders</h2>
                                </div>
                            
                    <div class="cart-table clearfix">

                        <table class="table table-responsive" id="refreshtr">
                            <thead>
                                <tr>
                                    <th>Product</th>
                                    <th>Quantity</th>
                                    <th>Status</th>
                                    <th>Price</th>
                                   
                                    
                                </tr>
                            </thead>

                            <tbody >
                                <% orderData.forEach((order) => { %>

                                    <% order.product.forEach((item) => { %>
                                        <tr >

                                            <td class="cart_product_img d-flex align-items-center">
                                                <a href="#"><img style="border-radius: 10px;"  src="/assets/img/<%=item.productId.image[0]%>" alt="Product"></a>
                                                <h6><%=item.productId.product%></h6>
                                            </td>
                                          <td><%= item.quantity %></td>
                                          <td><%= item.status%>
                                          <td>₹<%= item.singleTotal %></td>


                                          <% if (item.status != 'Return'&& item.status !='Order Cancelled'&& item.status !='Delivered') { %>

                                            <td>
                          
                                                <a  onclick="statuscancel('<%=item._id %>')">            
                                                                                        <button style="height: 40px; width: 90px; border: none; color: white; background-color: #FF084E; text-transform: uppercase; font-weight: bold; "  >Cancel</button>
                          
                                                </a>

                            </td>
                          
                         <% } %>
                                          
                                          <% if (item.status === 'Delivered') { %>

                                            <td>
                          
                                                <a  onclick="statusreturn('<%=item._id %>')">            
                                                                                        <button style="height: 40px; width: 90px; border: none; color: white; background-color: #FF084E; text-transform: uppercase; font-weight: bold; "  >Return</button>
                          
                                                </a>

                            </td>
                          
                         <% } %>
                                          
                                         
                                        </tr>
                                      <% }) %>
                                    
                                    <%})%>


                                   

                            </tbody>
                        </table>
                     
                          
                    </div>

                    <div class="cart-footer d-flex mt-30">
                        <div class="back-to-shop w-50">
                            <a href="/">Continue shoping</a>
                        </div>
                        <!-- <div class="update-checkout w-50 text-right">
                            <a href="#">clear cart</a>
                            <a href="#">Update cart</a>
                        </div> -->
                    </div>

                </div>
            </div>

           
        </div>
    </div>
    <!-- ****** Cart Area End ****** -->

    <!-- ****** Footer Area Start ****** -->
    <footer class="footer_area">
        <div class="container">
            <div class="row">
                <!-- Single Footer Area Start -->
           
                <!-- Single Footer Area Start -->
                <div class="col-12 col-sm-6 col-md-3 col-lg-2">
                    <div class="single_footer_area">
                        <ul class="footer_widget_menu">
                            <li><a href="#">About</a></li>
                            <li><a href="#">Blog</a></li>
                            <li><a href="#">Faq</a></li>
                            <li><a href="#">Returns</a></li>
                            <li><a href="#">Contact</a></li>
                        </ul>
                    </div>
                </div>
                <!-- Single Footer Area Start -->
                <div class="col-12 col-sm-6 col-md-3 col-lg-2">
                    <div class="single_footer_area">
                        <ul class="footer_widget_menu">
                            <li><a href="#">My Account</a></li>
                            <li><a href="#">Shipping</a></li>
                            <li><a href="#">Our Policies</a></li>
                            <li><a href="#">Afiliates</a></li>
                        </ul>
                    </div>
                </div>
                <!-- Single Footer Area Start -->
                <div class="col-12 col-lg-5">
                    <div class="single_footer_area">
                       
                    </div>
                </div>
            </div>
            <div class="line"></div>

            <!-- Footer Bottom Area Start -->
            <div class="footer_bottom_area">
                <div class="row">
                    <div class="col-12">
                        <div class="footer_social_area text-center">
                            <a href="#"><i class="fa fa-pinterest" aria-hidden="true"></i></a>
                            <a href="#"><i class="fa fa-facebook" aria-hidden="true"></i></a>
                            <a href="#"><i class="fa fa-twitter" aria-hidden="true"></i></a>
                            <a href="#"><i class="fa fa-linkedin" aria-hidden="true"></i></a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </footer>
    <!-- ****** Footer Area End ****** -->
</div>


<style>

    .store-pagination li a.active {
      background-color: #FF084E;
      color: #fff;
    }
    
    
        .store-filter {
      display: flex;
      justify-content: center;
      /* margin-top: 20px; */
      margin-bottom: 20px;
    }
    
    .store-pagination {
      display: flex;
      list-style: none;
      margin: 0;
      padding: 0;
    }
    
    .store-pagination li {
      margin: 0 5px;
    }
    
    .store-pagination li a {
      display: block;
      padding: 5px 10px;
      border-radius: 3px;
      background-color: #f5f5f5;
      color: #333;
      text-decoration: none;
    }
    
    .store-pagination li a:hover {
      background-color: #FF084E;
      color: #fff;
    }
    
    </style>

<script>

function statuscancel(proId) {
   
   console.log(proId)





   Swal.fire({
            title: 'Are you sure?',
            text: "You wan't to Cancel the Order!",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'yes, Cancel!'
        }).then((result) => {
            if (result.isConfirmed) {
               
                
                $.ajax({
   url: '/status-cancel',
   data: {
     productId: proId,
   },
   method: "post",
   success: (response) => {
     if (response.success) {
       $('#refreshtr').load('/loadorders #refreshtr')
       console.log(response);
       Swal.fire({
         title: 'Cancelled',
         text: 'Order Cancelled',
         icon: 'success',
         timer: 1000,
         showConfirmButton: false
       })
     } else {
       Swal.fire({
         text: 'Order already Cancelled',
         icon: 'info',
         timer: 1000,
         showConfirmButton: false
       })
     }
     console.log(response);
   }
 })
           }
                })

}
function statusreturn(proId) {
   
   console.log(proId)


   Swal.fire({
            title: 'Are you sure?',
            text: "You wan't to Return the Order!",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'yes, Return!'
        }).then((result) => {
            if (result.isConfirmed) {
               
                
                $.ajax({
   url: '/status-return',
   data: {
     productId: proId,
   },
   method: "post",
   success: (response) => {
     if (response.success) {
       $('#refreshtr').load('/loadorders #refreshtr')
       console.log(response);
       Swal.fire({
         title: 'Confirmed',
         text: 'Order return Confirmed',
         icon: 'success',
         timer: 1000,
         showConfirmButton: false
       })
     } else {
       Swal.fire({
         text: '',
         icon: 'info',
         timer: 1000,
         showConfirmButton: false
       })
     }
     console.log(response);
   }
 })
           }
                })

}

        </script>



<%-include('../layouts/userfooter.ejs') %>